import{s as et,d as b,A as nt,i as J,x as C,f as D,h as G,l as O,e as L,j as at,k as N,t as st,m as W,z as ot}from"../chunks/Bg6b8eG2.js";import{S as rt,i as lt,t as R,a as V,c as it,d as ct,m as ht,e as dt,b as ut,g as mt}from"../chunks/Dw1Mgn7V.js";import{e as X,g as ft,P as xt}from"../chunks/D6924oQB.js";const gt=!0,kt=Object.freeze(Object.defineProperty({__proto__:null,prerender:gt},Symbol.toStringTag,{value:"Module"})),{Boolean:_t}=ft;function F(r,s,o){const i=r.slice();return i[4]=s[o].dataPath,i[5]=s[o].countPath,i[6]=s,i[7]=o,i}function q(r){let s,o,i=r[4].replace(/-top1000\.json$/,"")+"",a,h,n,l=r[7],e,t;const c=()=>r[3](n,l),w=()=>r[3](null,l);let E={sketch:r[2](r[4],r[5])};return n=new xt({props:E}),c(),{c(){s=O("div"),o=O("div"),a=st(i),h=W(),ut(n.$$.fragment),e=W(),this.h()},l(d){s=D(d,"DIV",{class:!0});var u=G(s);o=D(u,"DIV",{class:!0});var _=G(o);a=at(_,i),_.forEach(b),h=N(u),dt(n.$$.fragment,u),e=N(u),u.forEach(b),this.h()},h(){C(o,"class","viz-title svelte-10gxfwn"),C(s,"class","viz-column svelte-10gxfwn")},m(d,u){J(d,s,u),L(s,o),L(o,a),L(s,h),ht(n,s,null),L(s,e),t=!0},p(d,u){l!==d[7]&&(w(),l=d[7],c());const _={};n.$set(_)},i(d){t||(V(n.$$.fragment,d),t=!0)},o(d){R(n.$$.fragment,d),t=!1},d(d){d&&b(s),w(),ct(n)}}}function yt(r){let s,o,i=X(r[1]),a=[];for(let n=0;n<i.length;n+=1)a[n]=q(F(r,i,n));const h=n=>R(a[n],1,1,()=>{a[n]=null});return{c(){s=O("div");for(let n=0;n<a.length;n+=1)a[n].c();this.h()},l(n){s=D(n,"DIV",{class:!0});var l=G(s);for(let e=0;e<a.length;e+=1)a[e].l(l);l.forEach(b),this.h()},h(){C(s,"class","viz-multi svelte-10gxfwn")},m(n,l){J(n,s,l);for(let e=0;e<a.length;e+=1)a[e]&&a[e].m(s,null);o=!0},p(n,[l]){if(l&7){i=X(n[1]);let e;for(e=0;e<i.length;e+=1){const t=F(n,i,e);a[e]?(a[e].p(t,l),V(a[e],1)):(a[e]=q(t),a[e].c(),V(a[e],1),a[e].m(s,null))}for(mt(),e=i.length;e<a.length;e+=1)h(e);it()}},i(n){if(!o){for(let l=0;l<i.length;l+=1)V(a[l]);o=!0}},o(n){a=a.filter(_t);for(let l=0;l<a.length;l+=1)R(a[l]);o=!1},d(n){n&&b(s),nt(a,n)}}}function Mt(r){const s=r.reduce((e,t)=>e+t.x,0)/r.length,o=r.reduce((e,t)=>e+t.y,0)/r.length;let i=0,a=0,h=0;r.forEach(e=>{const t=e.x-s,c=e.y-o;i+=t*t,a+=t*c,h+=c*c});let n=.5*Math.atan2(2*a,i-h);const l=r.map(e=>{const t=e.x-s,c=e.y-o,w=t*Math.cos(-n)-c*Math.sin(-n),E=t*Math.sin(-n)+c*Math.cos(-n);return w>0?E:null}).filter(e=>e!==null);return l.length&&l.reduce((e,t)=>e+t,0)/l.length<0&&(n+=Math.PI),{angle:n,center:{x:s,y:o}}}function vt(r,s,o){const i=r.x-o.x,a=r.y-o.y;return{x:i*Math.cos(-s)-a*Math.sin(-s)+o.x,y:i*Math.sin(-s)+a*Math.cos(-s)+o.y}}function pt(r,s=128){const o=r.length;return Array.from({length:s},(i,a)=>{const h=a*o/s,n=Math.floor(h),l=(n+1)%o,e=h-n,t=r[n].x*(1-e)+r[l].x*e,c=r[n].y*(1-e)+r[l].y*e;return{x:t,y:c}})}function Pt(r,s,o){return r.map((i,a)=>{const h=s[a];return{x:i.x*(1-o)+h.x*o,y:i.y*(1-o)+h.y*o}})}function St(r,s,o){const i=[{dataPath:"TP 261 Markt Hall-top1000.json",countPath:"TP 261 Markt Hall-top1000-count.json"},{dataPath:"TP 255 Serpentine Gallery Pavilion-top1000.json",countPath:"TP 255 Serpentine Gallery Pavilion-top1000-count.json"}];let a=Array(i.length).fill(null);const h=(l,e)=>t=>{let c=[],d=0,u=1,_=0;const K=.01,Q=.8,U=100,Z=800;t.preload=()=>{t.loadJSON(l,j=>{c=Object.entries(j).map(([v,m])=>{if(!Array.isArray(m.vertices)||m.vertices.length<2)return null;const{angle:k,center:T}=Mt(m.vertices),f=m.vertices.map(y=>vt(y,k,T)),M=f.map(y=>y.x),x=f.map(y=>y.y),p={minX:Math.min(...M),minY:Math.min(...x),w:Math.max(...M)-Math.min(...M),h:Math.max(...x)-Math.min(...x)};return{id:v,verts:f,resampledVerts:pt(f,128),bounds:p}}).filter(Boolean),Math.max(...c.map(v=>Math.max(v.bounds.w,v.bounds.h)),1)})},t.setup=()=>{t.createCanvas(t.windowWidth/i.length,t.windowHeight-30,t.WEBGL),t.frameRate(60)},t.draw=()=>{t._renderer.GL.disable(t._renderer.GL.DEPTH_TEST),t.push(),t.resetMatrix(),t.noStroke(),t.fill(255,10),t.rectMode(t.CORNER),t.translate(-t.width/2,-t.height/2,0),t.rect(0,0,t.width,t.height),t.pop(),t._renderer.GL.enable(t._renderer.GL.DEPTH_TEST),_+=K,_>=1&&(_=0,d=u,u=(u+1+Math.floor(Math.random()*(c.length-1)))%c.length,d===u&&(u=(u+1)%c.length));const j=c[d].resampledVerts,v=c[u].resampledVerts,m=Pt(j,v,_),k=m.map(g=>g.x),T=m.map(g=>g.y),f=Math.min(...k),M=Math.max(...k),x=Math.min(...T),p=Math.max(...T),y=Math.max(M-f,p-x),tt=Math.min(t.width,t.height)*Q,P=t.constrain(tt/y,U/y,Z/y),S=10;t.push(),t.translate(0,0,0),t.rotateY(t.frameCount*.008),t.stroke(0),t.noFill();for(let g of[-S/2,S/2])t.beginShape(),m.forEach($=>{const z=($.x-(f+(M-f)/2))*P,A=($.y-(x+(p-x)/2))*P;t.vertex(z,A,g)}),t.endShape(t.CLOSE);t.stroke("blue"),t.noFill();for(let g=0;g<m.length;g++){let $=(g+1)%m.length;const z=m[g],A=m[$],B=(z.x-(f+(M-f)/2))*P,H=(z.y-(x+(p-x)/2))*P,I=(A.x-(f+(M-f)/2))*P,Y=(A.y-(x+(p-x)/2))*P;t.beginShape(),t.vertex(B,H,-S/2),t.vertex(I,Y,-S/2),t.vertex(I,Y,+S/2),t.vertex(B,H,+S/2),t.endShape(t.CLOSE)}t.pop()},t.windowResized=()=>{t.resizeCanvas(t.windowWidth/i.length,t.windowHeight-30)}};function n(l,e){ot[l?"unshift":"push"](()=>{a[e]=l,o(0,a)})}return[a,i,h,n]}class Tt extends rt{constructor(s){super(),lt(this,s,St,yt,et,{})}}export{Tt as component,kt as universal};
