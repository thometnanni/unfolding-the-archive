import{s as X,d as j,A as K,b as Q,i as z,e as O,B as Z,x as B,f as H,h as A,j as L,k as D,l as F,t as G,m as I,n as tt}from"../chunks/Bg6b8eG2.js";import{S as et,i as nt,t as E,a as T,c as N,g as q,d as at,m as ot,e as st,b as lt}from"../chunks/Dw1Mgn7V.js";import{e as V,g as it,P as rt}from"../chunks/D6924oQB.js";const ct=!0,yt=Object.freeze(Object.defineProperty({__proto__:null,prerender:ct},Symbol.toStringTag,{value:"Module"})),{Boolean:ht}=it;function Y(i,n,l){const a=i.slice();return a[4]=n[l].dataPath,a[5]=n[l].countPath,a[7]=l,a}function R(i){let n,l;return n=new rt({props:{sketch:i[2](i[4],i[5],i[0])}}),{c(){lt(n.$$.fragment)},l(a){st(n.$$.fragment,a)},m(a,r){ot(n,a,r),l=!0},p(a,r){const u={};r&1&&(u.sketch=a[2](a[4],a[5],a[0])),n.$set(u)},i(a){l||(T(n.$$.fragment,a),l=!0)},o(a){E(n.$$.fragment,a),l=!1},d(a){at(n,a)}}}function W(i){let n,l,a=i[4].replace(/-top1000\.json$/,"")+"",r,u,d=i[0],f,c,s=R(i);return{c(){n=F("div"),l=F("div"),r=G(a),u=I(),s.c(),f=I(),this.h()},l(e){n=H(e,"DIV",{class:!0});var m=A(n);l=H(m,"DIV",{class:!0});var o=A(l);r=L(o,a),o.forEach(j),u=D(m),s.l(m),f=D(m),m.forEach(j),this.h()},h(){B(l,"class","viz-title svelte-n3fl1r"),B(n,"class","viz-column svelte-n3fl1r")},m(e,m){z(e,n,m),O(n,l),O(l,r),O(n,u),s.m(n,null),O(n,f),c=!0},p(e,m){m&1&&X(d,d=e[0])?(q(),E(s,1,1,tt),N(),s=R(e),s.c(),T(s,1),s.m(n,f)):s.p(e,m)},i(e){c||(T(s),c=!0)},o(e){E(s),c=!1},d(e){e&&j(n),s.d(e)}}}function ut(i){let n,l=i[0]?"Show Animation":"Show Overview",a,r,u,d,f,c,s=V(i[1]),e=[];for(let o=0;o<s.length;o+=1)e[o]=W(Y(i,s,o));const m=o=>E(e[o],1,1,()=>{e[o]=null});return{c(){n=F("button"),a=G(l),r=I(),u=F("div");for(let o=0;o<e.length;o+=1)e[o].c();this.h()},l(o){n=H(o,"BUTTON",{class:!0});var h=A(n);a=L(h,l),h.forEach(j),r=D(o),u=H(o,"DIV",{class:!0});var t=A(u);for(let v=0;v<e.length;v+=1)e[v].l(t);t.forEach(j),this.h()},h(){B(n,"class","toggle-btn svelte-n3fl1r"),B(u,"class","viz-multi svelte-n3fl1r")},m(o,h){z(o,n,h),O(n,a),z(o,r,h),z(o,u,h);for(let t=0;t<e.length;t+=1)e[t]&&e[t].m(u,null);d=!0,f||(c=Z(n,"click",i[3]),f=!0)},p(o,[h]){if((!d||h&1)&&l!==(l=o[0]?"Show Animation":"Show Overview")&&Q(a,l),h&7){s=V(o[1]);let t;for(t=0;t<s.length;t+=1){const v=Y(o,s,t);e[t]?(e[t].p(v,h),T(e[t],1)):(e[t]=W(v),e[t].c(),T(e[t],1),e[t].m(u,null))}for(q(),t=s.length;t<e.length;t+=1)m(t);N()}},i(o){if(!d){for(let h=0;h<s.length;h+=1)T(e[h]);d=!0}},o(o){e=e.filter(ht);for(let h=0;h<e.length;h+=1)E(e[h]);d=!1},d(o){o&&(j(n),j(r),j(u)),K(e,o),f=!1,c()}}}const dt=2,mt=5;function ft(i){const n=i.reduce((c,s)=>c+s.x,0)/i.length,l=i.reduce((c,s)=>c+s.y,0)/i.length;let a=0,r=0,u=0;i.forEach(c=>{const s=c.x-n,e=c.y-l;a+=s*s,r+=s*e,u+=e*e});let d=.5*Math.atan2(2*r,a-u);const f=i.map(c=>{const s=c.x-n,e=c.y-l,m=s*Math.cos(-d)-e*Math.sin(-d),o=s*Math.sin(-d)+e*Math.cos(-d);return m>0?o:null}).filter(c=>c!==null);return f.length&&f.reduce((c,s)=>c+s,0)/f.length<0&&(d+=Math.PI),{angle:d,center:{x:n,y:l}}}function _t(i,n,l){const a=i.x-l.x,r=i.y-l.y;return{x:a*Math.cos(-n)-r*Math.sin(-n)+l.x,y:a*Math.sin(-n)+r*Math.cos(-n)+l.y}}function gt(i,n,l){const a=[{dataPath:"TP 261 Markt Hall-top1000.json",countPath:"TP 261 Markt Hall-top1000-count.json"},{dataPath:"TP_255_Serpentine__Research_-top1000.json",countPath:"TP_255_Serpentine__Research_-top1000-count.json"},{dataPath:"TP_377_Boijmans-top1000.json",countPath:"TP_377_Boijmans-top1000-count.json"},{dataPath:"TP_255_Serpentine_Gallery_Pavilion-top1000.json",countPath:"TP_255_Serpentine_Gallery_Pavilion-top1000-count.json"}];let r=!1;function u(f,c,s){let e=[],m=1,o=0,h=0;return t=>{t.preload=()=>{t.loadJSON(f,v=>{e=Object.entries(v).map(([_,g])=>{if(!Array.isArray(g.vertices)||g.vertices.length<dt)return null;const{angle:w,center:P}=ft(g.vertices),y=g.vertices.map($=>_t($,w,P)),x=y.map($=>$.x),p=y.map($=>$.y),b={minX:Math.min(...x),minY:Math.min(...p),w:Math.max(...x)-Math.min(...x),h:Math.max(...p)-Math.min(...p)};if(b.w===0&&b.h===0)return null;const k=Math.max(b.w,b.h);return{id:_,verts:y,bounds:b,dim:k}}).filter(Boolean).sort((_,g)=>g.dim-_.dim);let M=e.map(_=>_.dim).sort((_,g)=>_-g),S=Math.floor(.98*(M.length-1));m=M[S]||1})},t.setup=()=>{t.createCanvas(t.windowWidth/a.length,t.windowHeight-30),s?t.noLoop():t.loop()},t.draw=()=>{if(t.background(0,0,0),!!e.length)if(s){const C=t.width/10;let S=Array(10).fill(0),_=[];for(let w=0;w<e.length;w++){const P=e[w],y=C*(1-.09)/P.bounds.w,x=P.bounds.h*y+C*.09;let p=S.indexOf(Math.min(...S)),b=p*C+C/2,k=S[p]+x/2;_.push({x:b,y:k,shape:P,shapeH:x,shapeScale:y}),S[p]+=x}const g=Math.max(...S);t.height!==g&&t.resizeCanvas(t.width,g,!0);for(let w=0;w<_.length;w++){const{x:P,y,shape:x,shapeScale:p}=_[w],{verts:b,bounds:k}=x;t.push(),t.translate(P,y),t.strokeWeight(1),t.noFill(),t.fill("white"),t.stroke("white"),t.beginShape(),b.forEach($=>{const J=($.x-(k.minX+k.w/2))*p,U=($.y-(k.minY+k.h/2))*p;t.vertex(J,U)}),t.endShape(t.CLOSE),t.pop()}}else{t.frameCount-h>mt&&(o=(o+1)%e.length,h=t.frameCount);const{verts:v,bounds:M}=e[o],S=Math.min(t.width,t.height)*.9,_=150,g=S/m,w=_/Math.max(M.w,M.h),P=Math.max(g,w);t.push(),t.translate(t.width/2,t.height/2),t.stroke("white"),t.fill("white"),t.beginShape(),v.forEach(y=>{const x=(y.x-(M.minX+M.w/2))*P,p=(y.y-(M.minY+M.h/2))*P;t.vertex(x,p)}),t.endShape(t.CLOSE),t.pop()}},t.windowResized=()=>{t.resizeCanvas(t.windowWidth/a.length,t.windowHeight-30),t.redraw()}}}function d(){l(0,r=!r)}return[r,a,u,d]}class xt extends et{constructor(n){super(),nt(this,n,gt,ut,X,{})}}export{xt as component,yt as universal};
